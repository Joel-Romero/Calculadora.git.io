<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ingresos y Egresos - Ministerio</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="ingresos.css">
</head>

<body>
  <div class="header">
    <div class="logo">
      <i class="fas fa-landmark"></i>
    </div>
    <h1>Ministerio de Trabajo</h1>
  </div>

  <div class="container">
    <div class="document-header">
      <div class="document-title">
        <h2>Rol de Pagos</h2>
      </div>
      <div class="document-ref">
        <i class="fas fa-file-invoice"></i>
        <span>Ref: <span id="documentRef">RP-2025-</span></span>
      </div>
    </div>
    
    <div class="section">
      <div class="section-header">
        <i class="fas fa-user-tie"></i>
        <h2>Información del Empleado</h2>
      </div>
      <table>
        <thead>
          <tr>
            <th>Concepto</th>
            <th>Valor</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="icon-cell"><i class="fas fa-user"></i> Nombre</td>
            <td id="nombreEmpleado"></td>
          </tr>
          <tr>
            <td class="icon-cell"><i class="fas fa-user-tag"></i> Apellido</td>
            <td id="apellidoEmpleado"></td>
          </tr>
          <tr>
            <td class="icon-cell"><i class="fas fa-briefcase"></i> Cargo</td>
            <td id="cargoEmpleado"></td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="section">
      <div class="section-header">
        <i class="fas fa-money-bill-wave"></i>
        <h2>Ingresos</h2>
      </div>
      <table>
        <thead>
          <tr>
            <th>Concepto</th>
            <th>Monto ($)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="icon-cell"><i class="fas fa-dollar-sign"></i> Sueldo Básico</td>
            <td class="currency" id="sueldoBasicoIngreso"></td>
          </tr>
          <tr>
            <td class="icon-cell"><i class="fas fa-hand-holding-usd"></i> Sueldo Devengado</td>
            <td class="currency" id="sueldoDevengadoIngreso"></td>
          </tr>
          <tr>
            <td class="icon-cell"><i class="fas fa-gift"></i> Décimo Tercero</td>
            <td class="currency" id="decimoTerceroIngreso"></td>
          </tr>
          <tr>
            <td class="icon-cell"><i class="fas fa-gift"></i> Décimo Cuarto</td>
            <td class="currency" id="decimoCuartoIngreso"></td>
          </tr>
          <tr>
            <td class="icon-cell"><i class="fas fa-umbrella-beach"></i> Vacaciones</td>
            <td class="currency" id="vacacionesIngreso"></td>
          </tr>
          <tr>
            <td class="icon-cell"><i class="fas fa-piggy-bank"></i> Fondo Reserva</td>
            <td class="currency" id="fondoReservaIngreso"></td>
          </tr>
          <tr class="total-row">
            <td class="icon-cell"><i class="fas fa-calculator"></i> Total Ingresos</td>
            <td class="currency" id="totalIngresos">0.00</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="section">
      <div class="section-header">
        <i class="fas fa-file-invoice-dollar"></i>
        <h2>Egresos</h2>
      </div>
      <table>
        <thead>
          <tr>
            <th>Concepto</th>
            <th>Monto ($)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="icon-cell"><i class="fas fa-file-invoice-dollar"></i> Pago IESS</td>
            <td><input type="number" id="pagoIESSEgreso" class="currency-input" placeholder="0.00" step="0.01" readonly></td>
          </tr>
          <tr>
            <td class="icon-cell"><i class="fas fa-clock"></i> Horas de Atraso</td>
            <td><input type="number" id="horasAtraso" class="currency-input" placeholder="0" step="0.01"></td>
          </tr>
          <tr>
            <td class="icon-cell"><i class="fas fa-money-bill"></i> Anticipos</td>
            <td><input type="number" id="anticipos" class="currency-input" placeholder="0.00" step="0.01"></td>
          </tr>
          <tr>
            <td class="icon-cell"><i class="fas fa-percent"></i> Faltas Otro Descuento</td>
            <td><input type="number" id="otroDescuento" class="currency-input" placeholder="0.00" step="0.01"></td>
          </tr>
          <tr>
            <td class="icon-cell"><i class="fas fa-credit-card"></i> Préstamos IESS</td>
            <td><input type="number" id="prestamosIESS" class="currency-input" placeholder="0.00" step="0.01"></td>
          </tr>
          <tr>
            <td class="icon-cell"><i class="fas fa-file-invoice-dollar"></i> Dscto. Imp. Renta</td>
            <td><input type="number" id="descuentoImpuestoRenta" class="currency-input" placeholder="0.00" step="0.01"></td>
          </tr>
          <tr>
            <td class="icon-cell"><i class="fas fa-file-invoice"></i> Impuesto Renta</td>
            <td><input type="number" id="impuestoRenta" class="currency-input" placeholder="0.00" step="0.01"></td>
          </tr>
          <tr>
            <td class="icon-cell"><i class="fas fa-heartbeat"></i> Seguro Médico Privado</td>
            <td><input type="number" id="seguroMedicoPrivado" class="currency-input" placeholder="0.00" step="0.01"></td>
          </tr>
          <tr class="total-row">
            <td class="icon-cell"><i class="fas fa-calculator"></i> Total Egresos</td>
            <td class="currency" id="totalEgresos">0.00</td>
          </tr>
        </tbody>
      </table>
    </div>
   
    <div class="section">
      <div class="section-header">
        <i class="fas fa-check-circle"></i>
        <h2>Líquido a Pagar</h2>
      </div>
      <table>
        <thead>
          <tr>
            <th>Concepto</th>
            <th>Monto ($)</th>
          </tr>
        </thead>
        <tbody>
          <tr class="total-row">
            <td class="icon-cell"><i class="fas fa-money-check-alt"></i> Sueldo Líquido a Pagar</td>
            <td class="currency" id="liquidoPagar">0.00</td>
          </tr>
        </tbody>
      </table>
    </div>

    

    <div class="button-group">
      <button class="button-section">
        <i class="fas fa-building"></i>
        Módulos Sector Privado
      </button>
      <button class="button-section">
        <i class="fas fa-landmark"></i>
        Módulos Sector Público
      </button>
    </div>

    <div id="modulos-privado" class="modulos-container">
      <div class="modulo-item">
        <span>Módulo 1 - Introducción a la Nómina en el Sector Privado
        </span>
        <button class="btn-descargar" onclick="descargarModulo('privado', 1)">Descargar</button>
      </div>
      <div class="modulo-item">
        <span>Módulo 2 - Ingresos en el Sector Privado
        </span>
        <button class="btn-descargar" onclick="descargarModulo('privado', 2)">Descargar</button>
      </div>
      <div class="modulo-item">
        <span>Módulo 3 - Deducciones y Aportes al IESS en el Sector Privado
        </span>
        <button class="btn-descargar" onclick="descargarModulo('privado', 3)">Descargar</button>
      </div>
      <div class="modulo-item">
        <span>Módulo 4 - Beneficios Sociales y Procedimientos de Nómina
        </span>
        <button class="btn-descargar" onclick="descargarModulo('privado', 4)">Descargar</button>
      </div>
      <div class="modulo-item">
        <span>Módulo 5 - Normativa Aplicable en el Sector Privado</span>
        <button class="btn-descargar" onclick="descargarModulo('privado', 5)">Descargar</button>
      </div>
    </div>

    <div id="modulos-publico" class="modulos-container">
      <div class="modulo-item">
        <span>Módulo 1 - Introducción a la Nómina en el Sector Público
        </span>
        <button class="btn-descargar" onclick="descargarModulo('publico', 1)">Descargar</button>
      </div>
      <div class="modulo-item">
        <span>Módulo 2 - Normativa Aplicable en el Sector Público
        </span>
        <button class="btn-descargar" onclick="descargarModulo('publico', 2)">Descargar</button>
      </div>
      <div class="modulo-item">
        <span>Módulo 3 - Ingresos en la Nómina del Sector Público
        </span>
        <button class="btn-descargar" onclick="descargarModulo('publico', 3)">Descargar</button>
      </div>
      <div class="modulo-item">
        <span>Módulo 4 - Deducciones en la Nómina del Sector Público
        </span>
        <button class="btn-descargar" onclick="descargarModulo('publico', 4)">Descargar</button>
      </div>
      <div class="modulo-item">
        <span>Módulo 5 - Beneficios Sociales en el Sector Público
        </span>
        <button class="btn-descargar" onclick="descargarModulo('publico', 5)">Descargar</button>
      </div>
      <div class="modulo-item">
        <span>Módulo 6 - Aportes al IESS en el Sector Público
        </span>
        <button class="btn-descargar" onclick="descargarModulo('publico', 6)">Descargar</button>
      </div>
      <div class="modulo-item">
        <span>Módulo 7 - Gestión de Nómina y su Relación con el Cumplimiento Normativo</span>
        <button class="btn-descargar"onclick="descargarModulo('publico', 7)">Descargar</button>
      </div>
  

      <div class="signature-section">
        <div class="signature-box">
          <div class="signature-line"></div>
          <div class="signature-name">Departamento de Recursos Humanos</div>
          <div class="signature-title">Autorizado por</div>
        </div>
        
        <div class="signature-box">
          <div class="signature-line"></div>
          <div class="signature-name" id="nombreCompletoEmpleado"></div>
          <div class="signature-title">Recibido por</div>
        </div>
      </div>
  </div>

  <div class="footer">
    <div class="footer-left">
      <i class="fas fa-shield-alt"></i>
      <span>Ministerio de Trabajo - República del Ecuador</span>
    </div>
    <div class="footer-right">
      <span id="currentDate"></span>
    </div>
  </div>

  <script>
    // Función para formatear números como moneda
    function formatCurrency(amount) {
      return parseFloat(amount).toFixed(2);
    }

    // Obtener parámetros de la URL
    const urlParams = new URLSearchParams(window.location.search);
    const nombre = urlParams.get("nombre") || "";
    const apellido = urlParams.get("apellido") || "";
    const cargo = urlParams.get("cargo") || "";
    const tipoTrabajo = urlParams.get("tipoTrabajo") || "";

    // Asignar valores a los elementos
    document.getElementById("nombreEmpleado").textContent = nombre;
    document.getElementById("apellidoEmpleado").textContent = apellido;
    document.getElementById("cargoEmpleado").textContent = cargo;
    document.getElementById("nombreCompletoEmpleado").textContent = nombre + " " + apellido;

    // Formatear y asignar valores monetarios
    const sueldoBasico = parseFloat(urlParams.get("sueldoBasico") || 0);
    const sueldoDevengado = parseFloat(urlParams.get("sueldoDevengado") || 0);
    const decimoTercero = parseFloat(urlParams.get("decimoTercero") || 0);
    const decimoCuarto = parseFloat(urlParams.get("decimoCuarto") || 0);
    const vacaciones = parseFloat(urlParams.get("vacaciones") || 0);
    const fondoReserva = parseFloat(urlParams.get("fondoReserva") || 0);

    document.getElementById("sueldoBasicoIngreso").textContent = formatCurrency(sueldoBasico);
    document.getElementById("sueldoDevengadoIngreso").textContent = formatCurrency(sueldoDevengado);
    document.getElementById("decimoTerceroIngreso").textContent = formatCurrency(decimoTercero);
    document.getElementById("decimoCuartoIngreso").textContent = formatCurrency(decimoCuarto);
    document.getElementById("vacacionesIngreso").textContent = formatCurrency(vacaciones);
    document.getElementById("fondoReservaIngreso").textContent = formatCurrency(fondoReserva);

    // Calcular el pago del IESS según el tipo de trabajo
    const tasaIESS = tipoTrabajo === "privado" ? 0.1145 : 0.0945;
    const aporteIESS = sueldoDevengado * tasaIESS;
    document.getElementById("pagoIESSEgreso").value = formatCurrency(aporteIESS);

    // Calcular total ingresos
    const totalIngresos = sueldoDevengado + decimoTercero + decimoCuarto + vacaciones + fondoReserva;
    document.getElementById("totalIngresos").textContent = formatCurrency(totalIngresos);

    // Función para actualizar totales
    function actualizarTotales() {
      const pagoIESS = parseFloat(document.getElementById("pagoIESSEgreso").value) || 0;
      const horasAtraso = parseFloat(document.getElementById("horasAtraso").value) || 0;
      const anticipos = parseFloat(document.getElementById("anticipos").value) || 0;
      const otroDescuento = parseFloat(document.getElementById("otroDescuento").value) || 0;
      const prestamosIESS = parseFloat(document.getElementById("prestamosIESS").value) || 0;
      const descuentoImpuestoRenta = parseFloat(document.getElementById("descuentoImpuestoRenta").value) || 0;
      const impuestoRenta = parseFloat(document.getElementById("impuestoRenta").value) || 0;
      const seguroMedicoPrivado = parseFloat(document.getElementById("seguroMedicoPrivado").value) || 0;

      // Calcular total egresos
      const totalEgresos = pagoIESS + horasAtraso + anticipos + otroDescuento + prestamosIESS + descuentoImpuestoRenta + impuestoRenta + seguroMedicoPrivado;
      document.getElementById("totalEgresos").textContent = formatCurrency(totalEgresos);

      // Calcular líquido a pagar
      const liquidoPagar = totalIngresos - totalEgresos;
      document.getElementById("liquidoPagar").textContent = formatCurrency(liquidoPagar);
    }

    // Agregar event listeners para actualizar totales al modificar los valores
    document.getElementById("horasAtraso").addEventListener("input", actualizarTotales);
    document.getElementById("anticipos").addEventListener("input", actualizarTotales);
    document.getElementById("otroDescuento").addEventListener("input", actualizarTotales);
    document.getElementById("prestamosIESS").addEventListener("input", actualizarTotales);
    document.getElementById("descuentoImpuestoRenta").addEventListener("input", actualizarTotales);
    document.getElementById("impuestoRenta").addEventListener("input", actualizarTotales);
    document.getElementById("seguroMedicoPrivado").addEventListener("input", actualizarTotales);

    // Inicializar totales
    actualizarTotales();

    // Generar número de referencia
    const date = new Date();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    const randomNum = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
    document.getElementById("documentRef").textContent += `${month}${day}-${randomNum}`;

    // Mostrar fecha actual
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    document.getElementById("currentDate").textContent = date.toLocaleDateString('es-ES', options);

    
    // Nuevas funciones para manejar los módulos
    function mostrarModulos(tipo) {
      // Ocultar todos los contenedores primero
      document.getElementById('modulos-privado').style.display = 'none';
      document.getElementById('modulos-publico').style.display = 'none';
      
      // Mostrar el contenedor correspondiente
      if (tipo === 'privado') {
        document.getElementById('modulos-privado').style.display = 'block';
      } else if (tipo === 'publico') {
        document.getElementById('modulos-publico').style.display = 'block';
      }
    }

    function descargarModulo(tipo, numero) {

      const modulosPrivado = [
        'assets/pdf/MODULO 1 - PRIVADO.pdf',
        'assets/pdf/MODULO 2 - PRIVADO.pdf',
        'assets/pdf/MODULO 3 - PRIVADO.pdf',
        'assets/pdf/MODULO 4 - PRIVADO.pdf',
        'assets/pdf/MODULO 5 - PRIVADO.pdf'
      ];
      
      const modulosPublico = [
        'assets/pdf/MODULO 1 - PUBLICO.pdf',
        'assets/pdf/MODULO 2 - PUBLICO.pdf',
        'assets/pdf/MODULO 3 - PUBLICO.pdf',
        'assets/pdf/MODULO 4 - PUBLICO.pdf',
        'assets/pdf/MODULO 5 - PUBLICO.pdf',
        'assets/pdf/MODULO 6 - PUBLICO.pdf',
        'assets/pdf/MODULO 7 - PUBLICO.pdf'
      ];
      
      let pdfUrl;
      let nombreArchivo;
      
      if (tipo === 'privado' && numero <= modulosPrivado.length) {
        pdfUrl = modulosPrivado[numero - 1];
        nombreArchivo = `Modulo_Privado_${numero}.pdf`;
      } else if (tipo === 'publico' && numero <= modulosPublico.length) {
        pdfUrl = modulosPublico[numero - 1];
        nombreArchivo = `Modulo_Publico_${numero}.pdf`;
      } else {
        alert('Módulo no disponible');
        return;
      }
      
      // Crear enlace para descarga
      var a = document.createElement('a');
      a.href = pdfUrl;
      a.download = nombreArchivo;
      a.click();
    }
  </script>
</body>
</html>